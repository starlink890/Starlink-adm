<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Starlink - Terminal Ma√Ætre</title>
    <style>
        body { font-family: sans-serif; background: #050a14; color: white; padding: 20px; }
        .panel { background: #0a1220; border: 1px solid #00d2ff; padding: 20px; border-radius: 15px; margin-bottom: 20px; }
        h2 { color: #00d2ff; border-bottom: 1px solid #00d2ff; padding-bottom: 10px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #1a2a40; padding: 12px; text-align: left; }
        th { background: #00d2ff; color: black; }
        .btn-valider { background: #4caf50; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; }
        .btn-delete { background: #f44336; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; }
        input { padding: 10px; border-radius: 5px; border: 1px solid #00d2ff; background: #111; color: white; }
    </style>
</head>
<body>

    <h1>üõ∞Ô∏è CENTRE DE CONTR√îLE STARLINK</h1>

    <div class="panel">
        <h2>üì• DEMANDES DE RECHARGE</h2>
        <table id="tableRecharges">
            <thead>
                <tr>
                    <th>T√©l√©phone</th>
                    <th>Montant (FC)</th>
                    <th>ID Transaction</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="bodyRecharges"></tbody>
        </table>
    </div>

    <div class="panel">
        <h2>üì§ DEMANDES DE RETRAIT</h2>
        <table id="tableRetraits">
            <thead>
                <tr>
                    <th>T√©l√©phone</th>
                    <th>Montant (FC)</th>
                    <th>R√©seau / Adresse</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="bodyRetraits"></tbody>
        </table>
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, onValue, remove, get, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyA24pBo8mBWiZssPtep--MMBdB7c8_Lu4U",
        authDomain: "dell-invest.firebaseapp.com",
        projectId: "dell-invest",
        storageBucket: "dell-invest.firebasestorage.app",
        messagingSenderId: "807081599583",
        appId: "1:807081599583:web:e00ec3959bc4acdae031ea"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // --- G√âRER LES RECHARGES ---
    onValue(ref(db, 'demandes_recharges'), (snap) => {
        const tbody = document.getElementById("bodyRecharges");
        tbody.innerHTML = "";
        snap.forEach(child => {
            const data = child.val();
            const row = `<tr>
                <td>${data.phone}</td>
                <td>${data.montant} FC</td>
                <td>${data.transactionID}</td>
                <td>
                    <button class="btn-valider" onclick="validerRecharge('${data.phone}', ${data.montant}, '${child.key}')">Valider</button>
                    <button class="btn-delete" onclick="supprimerDemande('demandes_recharges', '${child.key}')">X</button>
                </td>
            </tr>`;
            tbody.innerHTML += row;
        });
    });

    window.validerRecharge = async (phone, montant, key) => {
        const userRef = ref(db, 'users/' + phone);
        const userSnap = await get(userRef);
        if(userSnap.exists()){
            const actuel = userSnap.val().solde_principal || 0;
            await update(userRef, { solde_principal: actuel + montant });
            await remove(ref(db, 'demandes_recharges/' + key));
            alert("Compte cr√©dit√© avec succ√®s !");
        }
    };

    // --- G√âRER LES RETRAITS ---
    onValue(ref(db, 'demandes_retraits'), (snap) => {
        const tbody = document.getElementById("bodyRetraits");
        tbody.innerHTML = "";
        snap.forEach(child => {
            const data = child.val();
            const row = `<tr>
                <td>${data.phone}</td>
                <td>${data.montant} FC</td>
                <td>${data.reseau}</td>
                <td>
                    <button class="btn-valider" onclick="supprimerDemande('demandes_retraits', '${child.key}')">Pay√© & Archiver</button>
                </td>
            </tr>`;
            tbody.innerHTML += row;
        });
    });

    window.supprimerDemande = (chemin, key) => {
        if(confirm("Supprimer cette entr√©e ?")) {
            remove(ref(db, chemin + '/' + key));
        }
    };
</script>
</body>
</html>
